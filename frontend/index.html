<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vision & Hearing Screening Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }



        .form-container {
            padding: 40px;
        }

        /* Student ID Search Container */
        .student-id-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .student-id-container input {
            flex: 1;
        }

        .search-button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .search-button:hover {
            transform: translateY(-2px);
        }

        /* Mobile responsive layout */
        @media (max-width: 768px) {
            .student-id-container {
                flex-direction: column;
                align-items: stretch;
            }

            .student-id-container input {
                margin-bottom: 10px;
            }

            .search-button {
                width: 100%;
                padding: 14px 20px;
            }
        }

        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            background: #fafbfc;
        }

        .form-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        /* Collapsible Section */
        .collapsible-section {
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .collapsible-header {
            padding: 20px;
            background: #f8f9fa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .collapsible-header:hover {
            background: #e9ecef;
        }

        .collapsible-header.active {
            background: #e3f2fd;
            border-bottom: 2px solid #3498db;
        }

        .collapsible-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .collapsible-icon {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
            color: #6c757d;
        }

        .collapsible-icon.open {
            transform: rotate(90deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.open {
            max-height: 2000px;
        }

        .collapsible-inner {
            padding: 25px;
            background: #fafbfc;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .student-info-section {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border: 2px solid #00d4aa;
        }

        .student-info-section h2 {
            color: #00695c;
            border-bottom-color: #00d4aa;
        }

        .absent-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .absent-section h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .pass-fail-group {
            display: flex;
            gap: 20px;
            align-items: center;
            margin: 15px 0;
        }

        .pass-fail-group label {
            font-weight: 600;
            color: #2c3e50;
        }

        .radio-group {
            display: flex;
            gap: 15px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .radio-option:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .radio-option input[type="radio"] {
            margin: 0;
        }

        .radio-option.selected {
            border-color: #27ae60;
            background: #d5f4e6;
            color: #27ae60;
            font-weight: 600;
        }

        .radio-option.pass {
            border-color: #27ae60;
            background: #d4edda;
            color: #155724;
        }

        .radio-option.pass.selected {
            background: #c3e6cb;
            font-weight: 600;
        }

        .radio-option.failed {
            border-color: #e74c3c;
            background: #fadbd8;
            color: #c0392b;
        }

        .radio-option.failed.selected {
            background: #f8d7da;
            font-weight: 600;
        }

        .acuity-input {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .acuity-input input {
            width: 80px;
            text-align: center;
        }

        .hearing-frequencies {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 8px;
            border: 2px solid #ffc107;
        }

        .frequency-group {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .frequency-group > label {
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
            display: block;
            width: 100%;
        }

        .frequency-group .radio-group {
            justify-content: center;
            width: 100%;
        }

        .frequency-group input {
            width: 100%;
            text-align: center;
        }

        .session-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e8ed;
        }

        .session-tab {
            padding: 15px 25px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #6c757d;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            transition: all 0.3s ease;
        }

        .session-tab.active {
            background: #3498db;
            color: white;
        }

        .session-content {
            display: none;
        }

        .session-content.active {
            display: block;
        }

        .submit-section {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .submit-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
        }

        .hidden {
            display: none !important;
        }

        .required {
            color: #e74c3c;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            
            .pass-fail-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .radio-group {
                flex-direction: column;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Vision and Hearing Screening of Austin</h1>
            <p>Digital Screening Form - Streamlined Student Health Assessment</p>
        </div>

        <!-- Single Unified Form -->
        <div id="main-form">
        <div class="form-container">
                <!-- Student Lookup Section -->
                <div class="form-section student-info-section">
                <h2>üë§ Student Information</h2>
                        <div class="form-group">
                        <label for="uniqueId">Student ID:</label>
                        <div class="student-id-container">
                            <input type="text" id="uniqueId" placeholder="Enter Student ID" maxlength="20">
                            <button type="button" onclick="searchStudent()" class="search-button">
                                üîç Search
                            </button>
                        </div>
                    </div>
                
                    <div id="studentInfo" style="margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.7); border-radius: 8px;">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Grade:</label>
                                <select id="studentGrade" required>
                                    <option value="">Select Grade</option>
                                    <option value="Pre-K (3)">Pre-K (3)</option>
                                    <option value="Pre-K (4)">Pre-K (4)</option>
                                    <option value="Kindergarten">Kindergarten</option>
                                    <option value="1st">1st</option>
                                    <option value="2nd">2nd</option>
                                    <option value="3rd">3rd</option>
                                    <option value="4th">4th</option>
                                    <option value="5th">5th</option>
                                    <option value="6th">6th</option>
                                    <option value="7th">7th</option>
                                    <option value="8th">8th</option>
                                    <option value="9th">9th</option>
                                    <option value="10th">10th</option>
                                    <option value="11th">11th</option>
                                    <option value="12th">12th</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                    <div class="form-group">
                        <label>First Name:</label>
                                <input type="text" id="studentFirstName" placeholder="Enter first name" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name:</label>
                                <input type="text" id="studentLastName" placeholder="Enter last name" required>
                    </div>
                    <div class="form-group">
                                <label>Gender:</label>
                                <select id="studentGender" required>
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                    </div>
                    <div class="form-group">
                                <label>School:</label>
                                <select id="studentSchool" required>
                                    <option value="">Select School</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Teacher:</label>
                                <input type="text" id="studentTeacher" placeholder="Enter teacher name" required>
                    </div>
                    <div class="form-group">
                        <label>Date of Birth:</label>
                                <input type="date" id="studentDOB" required>
                    </div>
                    <div class="form-group">
                        <label>New/Returning:</label>
                                <select id="studentStatus" required>
                                    <option value="">Select Status</option>
                                    <option value="New">New</option>
                                    <option value="Returning">Returning</option>
                                </select>
                            </div>
                    </div>
                </div>
            </div>

            <!-- Required Screenings Banner -->
            <div id="requiredScreeningsBanner" class="form-section" style="display: none; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border: 2px solid #2196f3; border-radius: 10px; padding: 20px; margin: 20px 0;">
                <h2 style="color: #1976d2; margin-bottom: 15px; text-align: center;">üìã Required Screenings</h2>
                <div id="requiredScreeningsList" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                    <!-- Required screenings will be populated here -->
                </div>
            </div>

            <!-- Screener Information -->
                <div class="form-section">
                <h2>üë©‚Äç‚öïÔ∏è Screener Information</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="screenerName">Screener Name <span class="required">*</span>:</label>
                        <select id="screenerName" required>
                            <option value="">Select Screener</option>
                            <option value="Heather Broecklemann">Heather Broecklemann</option>
                            <option value="Katie Corlin">Katie Corlin</option>
                            <option value="Kristen Maracchini">Kristen Maracchini</option>
                            <option value="Tanja Saiidi">Tanja Saiidi</option>
                            <option value="Becki Sellers">Becki Sellers</option>
                            <option value="Lysette Reeves">Lysette Reeves</option>
                            <option value="Lynn Sawyer">Lynn Sawyer</option>
                            <option value="Erin Newman">Erin Newman</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="screeningDate">Screening Date <span class="required">*</span>:</label>
                        <input type="date" id="screeningDate" required>
                    </div>
                    </div>
                </div>

                <!-- Student Absent Section (Top Priority) -->
                <div class="absent-section">
                    <h3>üìã Student Attendance</h3>
                    <div class="form-group">
                        <label>Was the student present for screening?</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="handleAbsentChange(this, 'no')">
                                    <input type="radio" name="absent" value="no" checked>
                                    Present
                                </label>
                                <label class="radio-option failed" onclick="handleAbsentChange(this, 'yes')">
                                    <input type="radio" name="absent" value="yes">
                                    Absent
                                </label>
                            </div>
                    </div>
                </div>
            </div>

                <!-- Screening Tests Container -->
                <div id="screeningTestsContainer">
                    <!-- Vision Screening -->
                    <div id="visionSection" class="collapsible-section" data-section="vision">
                        <div class="collapsible-header" onclick="toggleCollapsible('vision')">
                            <span class="collapsible-title">üëÅÔ∏è Vision Screening</span>
                            <span class="collapsible-icon" id="vision-icon">‚ñ∂</span>
                        </div>
                        <div class="collapsible-content" id="vision-content">
                            <div class="collapsible-inner">
                <div class="session-tabs">
                    <button type="button" class="session-tab active" onclick="switchSession('vision', 'day1')">Initial Screening</button>
                    <button type="button" class="session-tab" onclick="switchSession('vision', 'day2')">Rescreen</button>
                </div>

                <div id="visionDay1" class="session-content active">
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="visionScreener1">Screener:</label>
                                        <select id="visionScreener1">
                                            <option value="">Select Screener</option>
                                            <option value="Heather Broecklemann">Heather Broecklemann</option>
                                            <option value="Katie Corlin">Katie Corlin</option>
                                            <option value="Kristen Maracchini">Kristen Maracchini</option>
                                            <option value="Tanja Saiidi">Tanja Saiidi</option>
                                            <option value="Becki Sellers">Becki Sellers</option>
                                            <option value="Lysette Reeves">Lysette Reeves</option>
                                            <option value="Lynn Sawyer">Lynn Sawyer</option>
                                            <option value="Erin Newman">Erin Newman</option>
                                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Wearing glasses/contacts during test?</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                                <label class="radio-option" onclick="selectRadio(this)">
                                    <input type="radio" name="glassesDay1" value="yes">
                                    Yes
                                </label>
                                                <label class="radio-option" onclick="selectRadio(this)">
                                    <input type="radio" name="glassesDay1" value="no">
                                    No
                                </label>
                            </div>
                        </div>
                    </div>

                    <div style="border-top: 2px solid #3498db; padding-top: 20px; margin-top: 20px;">
                        <label style="font-weight: bold; font-size: 1.15rem; color: #2c3e50; display: block; margin-bottom: 10px;">üëÅÔ∏è Overall Vision Results:</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this); handleVisionResult('pass', 'Day1')">
                                    <input type="radio" name="visionResultDay1" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this); handleVisionResult('fail', 'Day1')">
                                    <input type="radio" name="visionResultDay1" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Right Eye Acuity:</label>
                            <div class="acuity-input">
                                <span>20/</span>
                                <select id="rightEyeDay1">
                                    <option value="">Select</option>
                                    <option value="20">20</option>
                                    <option value="30">30</option>
                                    <option value="40">40</option>
                                    <option value="50">50</option>
                                    <option value="60">60</option>
                                    <option value="70">70</option>
                                    <option value="80">80</option>
                                    <option value="90">90</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Left Eye Acuity:</label>
                            <div class="acuity-input">
                                <span>20/</span>
                                <select id="leftEyeDay1">
                                    <option value="">Select</option>
                                    <option value="20">20</option>
                                    <option value="30">30</option>
                                    <option value="40">40</option>
                                    <option value="50">50</option>
                                    <option value="60">60</option>
                                    <option value="70">70</option>
                                    <option value="80">80</option>
                                    <option value="90">90</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="visionDay2" class="session-content">
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="visionScreener2">Screener:</label>
                        <select id="visionScreener2">
                            <option value="">Select Screener</option>
                            <option value="Heather Broecklemann">Heather Broecklemann</option>
                            <option value="Katie Corlin">Katie Corlin</option>
                            <option value="Kristen Maracchini">Kristen Maracchini</option>
                            <option value="Tanja Saiidi">Tanja Saiidi</option>
                            <option value="Becki Sellers">Becki Sellers</option>
                            <option value="Lysette Reeves">Lysette Reeves</option>
                            <option value="Lynn Sawyer">Lynn Sawyer</option>
                            <option value="Erin Newman">Erin Newman</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Wearing glasses/contacts during test?</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option" onclick="selectRadio(this)">
                                    <input type="radio" name="glassesDay2" value="yes">
                                    Yes
                                </label>
                                <label class="radio-option" onclick="selectRadio(this)">
                                    <input type="radio" name="glassesDay2" value="no">
                                    No
                                </label>
                            </div>
                        </div>
                    </div>

                    <div style="border-top: 2px solid #3498db; padding-top: 20px; margin-top: 20px;">
                        <label style="font-weight: bold; font-size: 1.15rem; color: #2c3e50; display: block; margin-bottom: 10px;">üëÅÔ∏è Overall Vision Results:</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this); handleVisionResult('pass', 'Day2')">
                                    <input type="radio" name="visionResultDay2" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this); handleVisionResult('fail', 'Day2')">
                                    <input type="radio" name="visionResultDay2" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Right Eye Acuity:</label>
                            <div class="acuity-input">
                                <span>20/</span>
                                <select id="rightEyeDay2">
                                    <option value="">Select</option>
                                    <option value="20">20</option>
                                    <option value="30">30</option>
                                    <option value="40">40</option>
                                    <option value="50">50</option>
                                    <option value="60">60</option>
                                    <option value="70">70</option>
                                    <option value="80">80</option>
                                    <option value="90">90</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Left Eye Acuity:</label>
                            <div class="acuity-input">
                                <span>20/</span>
                                <select id="leftEyeDay2">
                                    <option value="">Select</option>
                                    <option value="20">20</option>
                                    <option value="30">30</option>
                                    <option value="40">40</option>
                                    <option value="50">50</option>
                                    <option value="60">60</option>
                                    <option value="70">70</option>
                                    <option value="80">80</option>
                                    <option value="90">90</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>
            </div>

                    <!-- Hearing Screening -->
                    <div id="hearingSection" class="collapsible-section" data-section="hearing">
                        <div class="collapsible-header" onclick="toggleCollapsible('hearing')">
                            <span class="collapsible-title">üëÇ Hearing Screening</span>
                            <span class="collapsible-icon" id="hearing-icon">‚ñ∂</span>
                        </div>
                        <div class="collapsible-content" id="hearing-content">
                            <div class="collapsible-inner">
                <div class="session-tabs">
                    <button type="button" class="session-tab active" onclick="switchSession('hearing', 'day1')">Initial Screening</button>
                    <button type="button" class="session-tab" onclick="switchSession('hearing', 'day2')">Rescreen</button>
                </div>

                <div id="hearingDay1" class="session-content active">
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="hearingScreener1">Screener:</label>
                                        <select id="hearingScreener1">
                                            <option value="">Select Screener</option>
                                            <option value="Heather Broecklemann">Heather Broecklemann</option>
                                            <option value="Katie Corlin">Katie Corlin</option>
                                            <option value="Kristen Maracchini">Kristen Maracchini</option>
                                            <option value="Tanja Saiidi">Tanja Saiidi</option>
                                            <option value="Becki Sellers">Becki Sellers</option>
                                            <option value="Lysette Reeves">Lysette Reeves</option>
                                            <option value="Lynn Sawyer">Lynn Sawyer</option>
                                            <option value="Erin Newman">Erin Newman</option>
                                        </select>
                    </div>

                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; border: 2px solid #4caf50;">
                        <strong style="color: #2e7d32; font-size: 1.1rem;">Testing Level: 25 dL</strong>
                    </div>

                    <div style="border-top: 2px solid #3498db; padding-top: 20px; margin-top: 20px;">
                        <label style="font-weight: bold; font-size: 1.15rem; color: #2c3e50; display: block; margin-bottom: 10px;">üìä Overall Hearing Results:</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this); handleHearingResult('pass', 'Day1')">
                                    <input type="radio" name="hearingResultDay1" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this); handleHearingResult('fail', 'Day1')">
                                    <input type="radio" name="hearingResultDay1" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>

                                    <div id="hearingFrequencyDay1" style="display: none;">
                                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.2rem;">üëÇ Right Ear</h3>
                                    <div class="form-group">
                                        <label>1000 Hz</label>
                                        <div class="pass-fail-group">
                                            <div class="radio-group">
                                                <label class="radio-option pass" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingRight1000Day1" value="pass">
                                                    Pass
                                                </label>
                                                <label class="radio-option failed" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingRight1000Day1" value="fail">
                                                    Fail
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>2000 Hz</label>
                                        <div class="pass-fail-group">
                                            <div class="radio-group">
                                                <label class="radio-option pass" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingRight2000Day1" value="pass">
                                                    Pass
                                                </label>
                                                <label class="radio-option failed" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingRight2000Day1" value="fail">
                                                    Fail
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>4000 Hz</label>
                                        <div class="pass-fail-group">
                                            <div class="radio-group">
                                                <label class="radio-option pass" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingRight4000Day1" value="pass">
                                                    Pass
                                                </label>
                                                <label class="radio-option failed" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingRight4000Day1" value="fail">
                                                    Fail
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <h3 style="color: #2c3e50; margin: 25px 0 15px 0; font-size: 1.2rem;">üëÇ Left Ear</h3>
                                    <div class="form-group">
                                        <label>1000 Hz</label>
                                        <div class="pass-fail-group">
                                            <div class="radio-group">
                                                <label class="radio-option pass" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingLeft1000Day1" value="pass">
                                                    Pass
                                                </label>
                                                <label class="radio-option failed" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingLeft1000Day1" value="fail">
                                                    Fail
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>2000 Hz</label>
                                        <div class="pass-fail-group">
                                            <div class="radio-group">
                                                <label class="radio-option pass" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingLeft2000Day1" value="pass">
                                                    Pass
                                                </label>
                                                <label class="radio-option failed" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingLeft2000Day1" value="fail">
                                                    Fail
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>4000 Hz</label>
                                        <div class="pass-fail-group">
                                            <div class="radio-group">
                                                <label class="radio-option pass" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingLeft4000Day1" value="pass">
                                                    Pass
                                                </label>
                                                <label class="radio-option failed" onclick="selectRadio(this)">
                                                    <input type="radio" name="hearingLeft4000Day1" value="fail">
                                                    Fail
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                <div id="hearingDay2" class="session-content">
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="hearingScreener2">Screener:</label>
                        <select id="hearingScreener2">
                            <option value="">Select Screener</option>
                            <option value="Heather Broecklemann">Heather Broecklemann</option>
                            <option value="Katie Corlin">Katie Corlin</option>
                            <option value="Kristen Maracchini">Kristen Maracchini</option>
                            <option value="Tanja Saiidi">Tanja Saiidi</option>
                            <option value="Becki Sellers">Becki Sellers</option>
                            <option value="Lysette Reeves">Lysette Reeves</option>
                            <option value="Lynn Sawyer">Lynn Sawyer</option>
                            <option value="Erin Newman">Erin Newman</option>
                        </select>
                    </div>

                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; border: 2px solid #4caf50;">
                        <strong style="color: #2e7d32; font-size: 1.1rem;">Testing Level: 25 dL</strong>
                    </div>

                    <div style="border-top: 2px solid #3498db; padding-top: 20px; margin-top: 20px;">
                        <label style="font-weight: bold; font-size: 1.15rem; color: #2c3e50; display: block; margin-bottom: 10px;">üìä Overall Hearing Results:</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this); handleHearingResult('pass', 'Day2')">
                                    <input type="radio" name="hearingResultDay2" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this); handleHearingResult('fail', 'Day2')">
                                    <input type="radio" name="hearingResultDay2" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="hearingFrequencyDay2" style="display: none;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.2rem;">üëÇ Right Ear</h3>
                    
                    <div class="form-group">
                        <label>1000 Hz</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingRight1000Day2" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingRight1000Day2" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>2000 Hz</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingRight2000Day2" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingRight2000Day2" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>4000 Hz</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingRight4000Day2" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingRight4000Day2" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>

                    <h3 style="color: #2c3e50; margin: 25px 0 15px 0; font-size: 1.2rem;">üëÇ Left Ear</h3>
                    
                    <div class="form-group">
                        <label>1000 Hz</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingLeft1000Day2" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingLeft1000Day2" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>2000 Hz</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingLeft2000Day2" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingLeft2000Day2" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>4000 Hz</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingLeft4000Day2" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this)">
                                    <input type="radio" name="hearingLeft4000Day2" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                        </div>
                </div>
            </div>

                    <!-- Acanthosis Screening -->
                    <div id="acanthosisSection" class="collapsible-section" data-section="acanthosis">
                        <div class="collapsible-header" onclick="toggleCollapsible('acanthosis')">
                            <span class="collapsible-title">üî¨ Acanthosis Nigricans Screening</span>
                            <span class="collapsible-icon" id="acanthosis-icon">‚ñ∂</span>
                        </div>
                        <div class="collapsible-content" id="acanthosis-content">
                            <div class="collapsible-inner">
                <div class="session-tabs">
                    <button type="button" class="session-tab active" onclick="switchSession('acanthosis', 'day1')">Initial Screening</button>
                    <button type="button" class="session-tab" onclick="switchSession('acanthosis', 'day2')">Rescreen</button>
                </div>

                <div id="acanthosisDay1" class="session-content active">
                    <div class="form-group">
                        <label for="acanthosisScreener1">Screener:</label>
                                        <select id="acanthosisScreener1">
                                            <option value="">Select Screener</option>
                                            <option value="Heather Broecklemann">Heather Broecklemann</option>
                                            <option value="Katie Corlin">Katie Corlin</option>
                                            <option value="Kristen Maracchini">Kristen Maracchini</option>
                                            <option value="Tanja Saiidi">Tanja Saiidi</option>
                                            <option value="Becki Sellers">Becki Sellers</option>
                                            <option value="Lysette Reeves">Lysette Reeves</option>
                                            <option value="Lynn Sawyer">Lynn Sawyer</option>
                                            <option value="Erin Newman">Erin Newman</option>
                                        </select>
                    </div>

                    <div style="border-top: 2px solid #3498db; padding-top: 20px; margin-top: 20px;">
                        <label style="font-weight: bold; font-size: 1.15rem; color: #2c3e50; display: block; margin-bottom: 10px;">üî¨ Overall Acanthosis Nigricans Results:</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this)">
                                    <input type="radio" name="acanthosisResultDay1" value="pass">
                                    Pass
                                </label>
                                                <label class="radio-option failed" onclick="selectRadio(this)">
                                    <input type="radio" name="acanthosisResultDay1" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="acanthosisDay2" class="session-content">
                    <div class="form-group">
                        <label for="acanthosisScreener2">Screener:</label>
                                        <select id="acanthosisScreener2">
                                            <option value="">Select Screener</option>
                                            <option value="Heather Broecklemann">Heather Broecklemann</option>
                                            <option value="Katie Corlin">Katie Corlin</option>
                                            <option value="Kristen Maracchini">Kristen Maracchini</option>
                                            <option value="Tanja Saiidi">Tanja Saiidi</option>
                                            <option value="Becki Sellers">Becki Sellers</option>
                                            <option value="Lysette Reeves">Lysette Reeves</option>
                                            <option value="Lynn Sawyer">Lynn Sawyer</option>
                                            <option value="Erin Newman">Erin Newman</option>
                                        </select>
                    </div>

                    <div style="border-top: 2px solid #3498db; padding-top: 20px; margin-top: 20px;">
                        <label style="font-weight: bold; font-size: 1.15rem; color: #2c3e50; display: block; margin-bottom: 10px;">üî¨ Overall Acanthosis Nigricans Results:</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this)">
                                    <input type="radio" name="acanthosisResultDay2" value="pass">
                                    Pass
                                </label>
                                                <label class="radio-option failed" onclick="selectRadio(this)">
                                    <input type="radio" name="acanthosisResultDay2" value="fail">
                                    Fail
                                </label>
                                            </div>
                                        </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

                    <!-- Scoliosis Screening -->
                    <div id="scoliosisSection" class="collapsible-section" data-section="scoliosis">
                        <div class="collapsible-header" onclick="toggleCollapsible('scoliosis')">
                            <span class="collapsible-title">ü¶¥ Scoliosis Screening</span>
                            <span class="collapsible-icon" id="scoliosis-icon">‚ñ∂</span>
                        </div>
                        <div class="collapsible-content" id="scoliosis-content">
                            <div class="collapsible-inner">
                <div class="session-tabs">
                    <button type="button" class="session-tab active" onclick="switchSession('scoliosis', 'day1')">Initial Screening</button>
                    <button type="button" class="session-tab" onclick="switchSession('scoliosis', 'day2')">Rescreen</button>
                </div>

                <div id="scoliosisDay1" class="session-content active">
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="scoliosisScreener1">Screener:</label>
                                        <select id="scoliosisScreener1">
                                            <option value="">Select Screener</option>
                                            <option value="Heather Broecklemann">Heather Broecklemann</option>
                                            <option value="Katie Corlin">Katie Corlin</option>
                                            <option value="Kristen Maracchini">Kristen Maracchini</option>
                                            <option value="Tanja Saiidi">Tanja Saiidi</option>
                                            <option value="Becki Sellers">Becki Sellers</option>
                                            <option value="Lysette Reeves">Lysette Reeves</option>
                                            <option value="Lynn Sawyer">Lynn Sawyer</option>
                                            <option value="Erin Newman">Erin Newman</option>
                                        </select>
                    </div>

                    <div class="form-group">
                        <label>Scoliosis Observations:</label>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay1" value="uneven_shoulder">
                                Uneven shoulder
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay1" value="uneven_scapula">
                                Uneven scapula
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay1" value="waist_crease">
                                Accentuated waist crease on one side
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay1" value="unequal_arm_space">
                                Unequal arm body space
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay1" value="visible_curvature">
                                Visible lateral curvature of the spine
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay1" value="prominence">
                                Prominence on one side forward bending position
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay1" value="kyphosis">
                                Accentuated round back / Kyphosis
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay1" value="lordosis">
                                Accentuated sway back / Lordosis
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay1" value="other">
                                Other (See Additional notes)
                            </label>
                        </div>
                    </div>

                    <div style="border-top: 2px solid #3498db; padding-top: 20px; margin-top: 20px;">
                        <label style="font-weight: bold; font-size: 1.15rem; color: #2c3e50; display: block; margin-bottom: 10px;">ü¶¥ Overall Scoliosis Results:</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this)">
                                    <input type="radio" name="scoliosisResultDay1" value="pass">
                                    Pass
                                </label>
                                                <label class="radio-option failed" onclick="selectRadio(this)">
                                    <input type="radio" name="scoliosisResultDay1" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="scoliosisDay2" class="session-content">
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="scoliosisScreener2">Screener:</label>
                        <select id="scoliosisScreener2">
                            <option value="">Select Screener</option>
                            <option value="Heather Broecklemann">Heather Broecklemann</option>
                            <option value="Katie Corlin">Katie Corlin</option>
                            <option value="Kristen Maracchini">Kristen Maracchini</option>
                            <option value="Tanja Saiidi">Tanja Saiidi</option>
                            <option value="Becki Sellers">Becki Sellers</option>
                            <option value="Lysette Reeves">Lysette Reeves</option>
                            <option value="Lynn Sawyer">Lynn Sawyer</option>
                            <option value="Erin Newman">Erin Newman</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Scoliosis Observations:</label>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay2" value="uneven_shoulder">
                                Uneven shoulder
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay2" value="uneven_scapula">
                                Uneven scapula
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay2" value="waist_crease">
                                Accentuated waist crease on one side
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay2" value="unequal_arm_space">
                                Unequal arm body space
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay2" value="visible_curvature">
                                Visible lateral curvature of the spine
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay2" value="prominence">
                                Prominence on one side forward bending position
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay2" value="kyphosis">
                                Accentuated round back / Kyphosis
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay2" value="lordosis">
                                Accentuated sway back / Lordosis
                            </label>
                            <label class="radio-option">
                                <input type="checkbox" name="scoliosisObservationsDay2" value="other">
                                Other (See Additional notes)
                            </label>
                        </div>
                    </div>

                    <div style="border-top: 2px solid #3498db; padding-top: 20px; margin-top: 20px;">
                        <label style="font-weight: bold; font-size: 1.15rem; color: #2c3e50; display: block; margin-bottom: 10px;">ü¶¥ Overall Scoliosis Results:</label>
                        <div class="pass-fail-group">
                            <div class="radio-group">
                                <label class="radio-option pass" onclick="selectRadio(this)">
                                    <input type="radio" name="scoliosisResultDay2" value="pass">
                                    Pass
                                </label>
                                <label class="radio-option failed" onclick="selectRadio(this)">
                                    <input type="radio" name="scoliosisResultDay2" value="fail">
                                    Fail
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>
            </div>

                    <!-- Additional Notes -->
            <div class="form-section">
                        <h2>üìù Additional Notes</h2>
                        <div class="form-group">
                            <label for="notes">Additional observations or comments:</label>
                            <textarea id="notes" rows="3" placeholder="Any additional notes..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="submit-section">
            <button type="button" class="submit-btn" onclick="submitForm()">Submit Screening Results</button>
        </div>
    </div>

    <script>


        // Collapsible section toggle
        function toggleCollapsible(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const icon = document.getElementById(sectionId + '-icon');
            const header = event.currentTarget;
            
            if (content.classList.contains('open')) {
                // Close the section
                content.classList.remove('open');
                icon.classList.remove('open');
                icon.textContent = '‚ñ∂';
                header.classList.remove('active');
            } else {
                // Open the section
                content.classList.add('open');
                icon.classList.add('open');
                icon.textContent = '‚ñº';
                header.classList.add('active');
            }
        }

        // Backend API URLs
        const API_BASE = 'http://localhost:3000/api';

        // Vision auto-fill logic
        function handleVisionResult(result, day) {
            const rightEyeSelect = document.getElementById(`rightEye${day}`);
            const leftEyeSelect = document.getElementById(`leftEye${day}`);
            
            if (result === 'pass') {
                // Auto-fill both dropdowns to "20" but keep them editable
                rightEyeSelect.value = '20';
                leftEyeSelect.value = '20';
                rightEyeSelect.disabled = false;
                leftEyeSelect.disabled = false;
            } else if (result === 'fail') {
                // Enable dropdowns but leave empty
                rightEyeSelect.disabled = false;
                leftEyeSelect.disabled = false;
                rightEyeSelect.value = '';
                leftEyeSelect.value = '';
            }
        }

        // Hearing conditional show/hide logic
        function handleHearingResult(result, day) {
            const frequencySection = document.getElementById(`hearingFrequency${day}`);
            
            if (result === 'pass') {
                // Hide frequency section and clear values
                frequencySection.style.display = 'none';
                clearHearingFrequencies(day);
            } else if (result === 'fail') {
                // Show frequency section
                frequencySection.style.display = 'block';
            }
        }

        // Clear hearing frequency values
        function clearHearingFrequencies(day) {
            const frequencies = ['1000', '2000', '4000'];
            frequencies.forEach(freq => {
                document.querySelectorAll(`input[name="hearingRight${freq}${day}"]`).forEach(input => input.checked = false);
                document.querySelectorAll(`input[name="hearingLeft${freq}${day}"]`).forEach(input => input.checked = false);
            });
        }

        // Check if a screening section is open
        function isSectionOpen(section) {
            const sectionElement = document.getElementById(`${section}Section`);
            const contentElement = document.getElementById(`${section}-content`);
            
            if (!sectionElement || !contentElement) return false;
            
            // Check if section is visible (not hidden by display: none)
            const isVisible = contentElement.style.display !== 'none';
            
            // Check if section is expanded (has active class or content is visible)
            const isExpanded = sectionElement.classList.contains('active') || 
                              contentElement.style.display === 'block';
            
            return isVisible && isExpanded;
        }

        // Load schools from API
        async function loadSchools() {
            try {
                const response = await fetch(`${API_BASE}/schools`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                const schoolSelect = document.getElementById('studentSchool');
                schoolSelect.innerHTML = '<option value="">Select School</option>';
                
                if (data.schools && data.schools.length > 0) {
                    data.schools.forEach(school => {
                        const option = document.createElement('option');
                        option.value = school.name;
                        option.textContent = school.name;
                        schoolSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading schools:', error);
                // Fallback: add some default schools
                const schoolSelect = document.getElementById('studentSchool');
                schoolSelect.innerHTML = `
                    <option value="">Select School</option>
                    <option value="Landing Page Elementary">Landing Page Elementary</option>
                    <option value="St Michaels">St Michaels</option>
                    <option value="Central Elementary">Central Elementary</option>
                `;
            }
        }

        // Show required screenings banner
        function showRequiredScreenings(requiredScreenings) {
            const banner = document.getElementById('requiredScreeningsBanner');
            const list = document.getElementById('requiredScreeningsList');
            
            if (!requiredScreenings) {
                banner.style.display = 'none';
                return;
            }
            
            // Clear previous content
            list.innerHTML = '';
            
            // Create screening badges
            const screenings = [
                { key: 'vision', name: 'üëÅÔ∏è Vision', icon: 'üëÅÔ∏è' },
                { key: 'hearing', name: 'üëÇ Hearing', icon: 'üëÇ' },
                { key: 'acanthosis', name: 'üîç Acanthosis', icon: 'üîç' },
                { key: 'scoliosis', name: 'ü¶¥ Scoliosis', icon: 'ü¶¥' }
            ];
            
            screenings.forEach(screening => {
                if (requiredScreenings[screening.key]) {
                    const badge = document.createElement('div');
                    badge.style.cssText = `
                        background: linear-gradient(135deg, #4caf50, #45a049);
                        color: white;
                        padding: 8px 16px;
                        border-radius: 20px;
                        font-weight: bold;
                        font-size: 14px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    `;
                    badge.textContent = screening.name;
                    list.appendChild(badge);
                }
            });
            
            // Show banner if there are required screenings
            if (list.children.length > 0) {
                banner.style.display = 'block';
            } else {
                banner.style.display = 'none';
            }
        }

        // Helper function to open accordion sections
        function openAccordion(section) {
            const accordion = document.querySelector(`[data-section="${section}"]`);
            if (accordion) {
                const content = accordion.querySelector('.collapsible-content');
                const icon = accordion.querySelector('.collapsible-icon');
                const header = accordion.querySelector('.collapsible-header');
                
                if (content) {
                    content.classList.add('open');
                    icon.classList.add('open');
                    icon.textContent = '‚ñ≤';
                    header.classList.add('active');
                }
            }
        }

        // Clear student information fields
        function clearStudentInfo() {
            // Clear Student ID
            document.getElementById('uniqueId').value = '';
            
            // Clear all student information fields
            document.getElementById('studentGrade').selectedIndex = 0;
            document.getElementById('studentFirstName').value = '';
            document.getElementById('studentLastName').value = '';
            document.getElementById('studentGender').selectedIndex = 0;
            document.getElementById('studentSchool').value = '';
            document.getElementById('studentTeacher').value = '';
            document.getElementById('studentDOB').value = '';
            document.getElementById('studentStatus').selectedIndex = 0;
        }

        // Student search functionality using webhook
        async function searchStudent() {
            const uniqueId = document.getElementById('uniqueId').value.trim();
            
            if (!uniqueId) {
                alert('Please enter a Student ID to search');
                return;
            }

            // Show loading state
            const searchButton = document.querySelector('button[onclick="searchStudent()"]');
            const originalText = searchButton.innerHTML;
            searchButton.innerHTML = '‚è≥ Searching...';
            searchButton.disabled = true;

            try {
                const response = await fetch(`${API_BASE}/students/${uniqueId.toLowerCase()}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const responseData = await response.json();
                
                if (responseData.found && responseData.student) {
                    const studentData = responseData.student;
                    // Fill in student information from API response
                    fillStudentForm(studentData);
                    
                    // Open required sections based on student data
                    openRequiredSections(studentData);
                    
                    showSuccessMessage('Student found and information loaded!');
                } else {
                    showErrorMessage('Student not found. Please check the Student ID or enter information manually.');
                clearStudentInfo();
                closeAllScreeningSections();
                showRequiredScreenings(null); // Hide banner
                
                // Show all sections for manual entry
                document.getElementById('visionSection').style.display = 'block';
                document.getElementById('hearingSection').style.display = 'block';
                document.getElementById('acanthosisSection').style.display = 'block';
                document.getElementById('scoliosisSection').style.display = 'block';
            }
            } catch (error) {
                console.error('Search error:', error);
                showErrorMessage('Error searching for student. Please try again or enter information manually.');
                clearStudentInfo();
                closeAllScreeningSections();
                showRequiredScreenings(null); // Hide banner
                
                // Show all sections for manual entry
                document.getElementById('visionSection').style.display = 'block';
                document.getElementById('hearingSection').style.display = 'block';
                document.getElementById('acanthosisSection').style.display = 'block';
                document.getElementById('scoliosisSection').style.display = 'block';
            } finally {
                // Reset button state
                searchButton.innerHTML = originalText;
                searchButton.disabled = false;
            }
        }

        function fillStudentForm(studentData) {
            // Fill in student information from webhook response
            if (studentData.grade) document.getElementById('studentGrade').value = studentData.grade;
            if (studentData.firstName) document.getElementById('studentFirstName').value = studentData.firstName;
            if (studentData.lastName) document.getElementById('studentLastName').value = studentData.lastName;
            if (studentData.gender) document.getElementById('studentGender').value = studentData.gender;
            if (studentData.school) document.getElementById('studentSchool').value = studentData.school;
            if (studentData.teacher) document.getElementById('studentTeacher').value = studentData.teacher;
            if (studentData.dob) document.getElementById('studentDOB').value = studentData.dob;
            if (studentData.status) document.getElementById('studentStatus').value = studentData.status;
            
            // Calculate and show screening sections based on grade, gender, and status
            const isNew = studentData.status === 'New';
            const screenings = getScreeningsByGrade(studentData.grade, studentData.gender, isNew);
            showScreeningSections(screenings);
        }

        function showSuccessMessage(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #27ae60, #2ecc71);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showErrorMessage(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        function showScreeningSections(student) {
            // Close all sections first
            closeAllScreeningSections();
            
            // Auto-expand relevant sections
            if (student.vision) {
                openSection('vision');
            }
            if (student.hearing) {
                openSection('hearing');
            }
            if (student.acanthosis) {
                openSection('acanthosis');
            }
            if (student.scoliosis) {
                openSection('scoliosis');
            }
        }

        function openSection(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const icon = document.getElementById(sectionId + '-icon');
            const header = document.querySelector(`[onclick="toggleCollapsible('${sectionId}')"]`);
            
            if (content && icon) {
                content.classList.add('open');
                icon.classList.add('open');
                icon.textContent = '‚ñº';
                if (header) {
                    header.classList.add('active');
                }
            }
        }

        // Determine required screenings based on grade, gender, and new/returning status
        function getScreeningsByGrade(grade, gender, isNew) {
            const gradeNorm = (grade || '').toLowerCase().trim();
            const genderNorm = (gender || '').toLowerCase().trim();
            
            // Default all to false
            const screenings = {
                vision: false,
                hearing: false,
                acanthosis: false,
                scoliosis: false
            };
            
            // PreK 3, PreK 4, Kindergarten
            if (gradeNorm.includes('pre-k') || gradeNorm === 'kindergarten') {
                screenings.vision = true;
                screenings.hearing = true;
            }
            
            // 1st grade
            else if (gradeNorm === '1st') {
                screenings.vision = true;
                screenings.hearing = true;
                screenings.acanthosis = true;
            }
            
            // 2nd grade (NEW only)
            else if (gradeNorm === '2nd') {
                if (isNew) {
                    screenings.vision = true;
                    screenings.hearing = true;
                    screenings.acanthosis = true;
                }
            }
            
            // 3rd grade
            else if (gradeNorm === '3rd') {
                screenings.vision = true;
                screenings.hearing = true;
                screenings.acanthosis = true;
            }
            
            // 4th grade (NEW only)
            else if (gradeNorm === '4th') {
                if (isNew) {
                    screenings.vision = true;
                    screenings.hearing = true;
                    screenings.acanthosis = true;
                }
            }
            
            // 5th grade FEMALES
            else if (gradeNorm === '5th' && genderNorm === 'female') {
                screenings.vision = true;
                screenings.hearing = true;
                screenings.acanthosis = true;
                screenings.scoliosis = true;
            }
            
            // 5th grade MALES
            else if (gradeNorm === '5th' && genderNorm === 'male') {
                screenings.vision = true;
                screenings.hearing = true;
                screenings.acanthosis = true;
            }
            
            // 6th grade (NEW only)
            else if (gradeNorm === '6th') {
                if (isNew) {
                    screenings.vision = true;
                    screenings.hearing = true;
                    screenings.acanthosis = true;
                }
            }
            
            // 7th grade FEMALES
            else if (gradeNorm === '7th' && genderNorm === 'female') {
                screenings.vision = true;
                screenings.hearing = true;
                screenings.acanthosis = true;
                screenings.scoliosis = true;
            }
            
            // 7th grade MALES
            else if (gradeNorm === '7th' && genderNorm === 'male') {
                screenings.vision = true;
                screenings.hearing = true;
                screenings.acanthosis = true;
            }
            
            // 8th grade MALES RETURNING (scoliosis only!)
            else if (gradeNorm === '8th' && genderNorm === 'male' && !isNew) {
                screenings.scoliosis = true;
            }
            
            // 8th grade MALES NEW
            else if (gradeNorm === '8th' && genderNorm === 'male' && isNew) {
                screenings.vision = true;
                screenings.hearing = true;
                screenings.acanthosis = true;
                screenings.scoliosis = true;
            }
            
            // 8th grade FEMALES NEW
            else if (gradeNorm === '8th' && genderNorm === 'female' && isNew) {
                screenings.vision = true;
                screenings.hearing = true;
                screenings.acanthosis = true;
            }
            
            // 9th-12th grade (NEW only)
            else if (['9th', '10th', '11th', '12th'].includes(gradeNorm)) {
                if (isNew) {
                    screenings.vision = true;
                    screenings.hearing = true;
                    screenings.acanthosis = true;
                }
            }
            
            return screenings;
        }

        // Update screenings when any relevant field changes
        function updateScreeningSections() {
            const grade = document.getElementById('studentGrade').value;
            const gender = document.getElementById('studentGender').value;
            const status = document.getElementById('studentStatus').value;
            const isNew = status === 'New';
            
            if (grade && gender && status) {
                const screenings = getScreeningsByGrade(grade, gender, isNew);
                showScreeningSections(screenings);
                
                // Check if any screenings are required
                const hasAnyScreenings = screenings.vision || screenings.hearing || 
                                        screenings.acanthosis || screenings.scoliosis;
                
                if (!hasAnyScreenings) {
                    // No screenings required for this grade/gender/status combination
                }
            }
        }

        // Auto-expand sections when grade, gender, or status changes
        document.getElementById('studentGrade').addEventListener('change', updateScreeningSections);
        document.getElementById('studentGender').addEventListener('change', updateScreeningSections);
        document.getElementById('studentStatus').addEventListener('change', updateScreeningSections);

        function closeAllScreeningSections() {
            const sections = ['vision', 'hearing', 'acanthosis', 'scoliosis'];
            sections.forEach(section => {
                const content = document.getElementById(section + '-content');
                const icon = document.getElementById(section + '-icon');
                const header = document.querySelector(`[onclick="toggleCollapsible('${section}')"]`);
                
                // Close the accordion if it was open
                if (content) {
                    content.classList.remove('open');
                    icon.classList.remove('open');
                    icon.textContent = '‚ñº';
                    if (header) {
                        header.classList.remove('active');
                    }
                }
            });
        }

        // Auto-fill screener dropdowns when main screener is selected
        document.getElementById('screenerName').addEventListener('change', function() {
            const screenerName = this.value;
            if (screenerName) {
                // Only auto-fill screener dropdowns for open sections
                const openSections = ['vision', 'hearing', 'acanthosis', 'scoliosis'];
                
                openSections.forEach(section => {
                    const sectionElement = document.getElementById(`${section}Section`);
                    const contentElement = document.getElementById(`${section}-content`);
                    
                    // Check if section is open (has 'active' class or is visible)
                    if (sectionElement && contentElement && 
                        (sectionElement.classList.contains('active') || 
                         contentElement.style.display !== 'none')) {
                        
                        // Fill screener dropdowns for this section
                        const screener1 = document.getElementById(`${section}Screener1`);
                        const screener2 = document.getElementById(`${section}Screener2`);
                        
                        if (screener1) screener1.value = screenerName;
                        if (screener2) screener2.value = screenerName;
                    }
                });
            }
        });

        // Handle absent/present toggle
        function handleAbsentChange(element, value) {
            selectRadio(element);
            const testsContainer = document.getElementById('screeningTestsContainer');
            const acanthosisSection = document.getElementById('acanthosisSection');
            const scoliosisSection = document.getElementById('scoliosisSection');
            
            if (value === 'yes') {
                testsContainer.classList.add('hidden');
                if (acanthosisSection) acanthosisSection.classList.add('hidden');
                if (scoliosisSection) scoliosisSection.classList.add('hidden');
            } else {
                testsContainer.classList.remove('hidden');
                if (acanthosisSection) acanthosisSection.classList.remove('hidden');
                if (scoliosisSection) scoliosisSection.classList.remove('hidden');
            }
        }

        // Session tab switching
        function switchSession(screeningType, day) {
            const container = document.querySelector(`#${screeningType}Day1`).closest('.collapsible-inner');
            
            // Remove active class from all tabs in this section
            container.querySelectorAll('.session-tab').forEach(tab => tab.classList.remove('active'));
            
            // Hide all content in this section
            container.querySelectorAll('.session-content').forEach(content => content.classList.remove('active'));
            
            // Show selected tab and content
            const targetTab = container.querySelector(`[onclick="switchSession('${screeningType}', '${day}')"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            const targetContent = document.getElementById(`${screeningType}${day.charAt(0).toUpperCase() + day.slice(1)}`);
            if (targetContent) {
                targetContent.classList.add('active');
            }
        }

        // Radio button selection helper
        function selectRadio(element) {
            const radio = element.querySelector('input[type="radio"]');
            if (radio) {
                radio.checked = true;
                
                // Update visual state
                const group = element.closest('.radio-group');
                group.querySelectorAll('.radio-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                element.classList.add('selected');
            }
        }

        // Form submission using webhook
        async function submitForm() {
            // Validate form before submission
            const validation = validateForm();
            if (!validation.isValid) {
                showValidationError(validation.errors);
                return;
            }

            let formData = {
                uniqueId: document.getElementById('uniqueId').value,
                absent: document.querySelector('input[name="absent"]:checked')?.value === 'true',
                notes: document.getElementById('notes').value,
                screeningYear: new Date().getFullYear(),
                screeningEventDate: document.getElementById('screeningDate').value,
                
                // Only gather screening data for open sections
                vision: isSectionOpen('vision') ? gatherScreeningData('vision', '') : null,
                hearing: isSectionOpen('hearing') ? gatherScreeningData('hearing', '') : null,
                acanthosis: isSectionOpen('acanthosis') ? gatherScreeningData('acanthosis', '') : null,
                scoliosis: isSectionOpen('scoliosis') ? gatherScreeningData('scoliosis', '') : null
            };
            
            console.log('Form data to submit:', JSON.stringify(formData, null, 2));
            
            // Show loading state
            const submitButton = document.querySelector('button[onclick="submitForm()"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '‚è≥ Submitting...';
            submitButton.disabled = true;

            try {
                const response = await fetch(`${API_BASE}/screenings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Submission successful:', result);
                
                // Show success modal
                showSuccessModal(formData);
                
            } catch (error) {
                console.error('Submission error:', error);
                showErrorMessage('Error submitting form. Please try again.');
            } finally {
                // Reset button state
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        }

        // Comprehensive form validation
        function validateForm() {
            const errors = [];
            
            // Check required global fields
            if (!document.getElementById('screenerName').value) {
                errors.push('Please select a Screener Name');
            }
            if (!document.getElementById('screeningDate').value) {
                errors.push('Please select a Screening Date');
            }
            
            // Check student information
            if (!document.getElementById('studentGrade').value) {
                errors.push('Please select student Grade');
            }
            if (!document.getElementById('studentFirstName').value.trim()) {
                errors.push('Please enter student First Name');
            }
            if (!document.getElementById('studentLastName').value.trim()) {
                errors.push('Please enter student Last Name');
            }
            if (!document.getElementById('studentGender').value) {
                errors.push('Please select student Gender');
            }
            if (!document.getElementById('studentSchool').value.trim()) {
                errors.push('Please enter student School');
            }
            if (!document.getElementById('studentDOB').value) {
                errors.push('Please enter student Date of Birth');
            }
            if (!document.getElementById('studentStatus').value) {
                errors.push('Please select student New/Returning status');
            }
            
            // Check if student is absent - if yes, no need to validate screenings
            const isAbsent = document.querySelector('input[name="absent"]:checked')?.value === 'yes';
            
            if (!isAbsent) {
                // Check if at least one screening section is open
                const visionOpen = document.getElementById('vision-content').classList.contains('open');
                const hearingOpen = document.getElementById('hearing-content').classList.contains('open');
                const acanthosisOpen = document.getElementById('acanthosis-content').classList.contains('open');
                const scoliosisOpen = document.getElementById('scoliosis-content').classList.contains('open');
                
                if (!visionOpen && !hearingOpen && !acanthosisOpen && !scoliosisOpen) {
                    errors.push('Please open and complete at least one screening section (Vision, Hearing, Acanthosis Nigricans, or Scoliosis)');
                }
                
                // Check each screening section if it's open
                validateVisionSection(errors);
                validateHearingSection(errors);
                validateAcanthosisSection(errors);
                validateScoliosisSection(errors);
            }
            
            return {
                isValid: errors.length === 0,
                errors: errors
            };
        }

        function validateVisionSection(errors) {
            const visionContent = document.getElementById('vision-content');
            if (!visionContent.classList.contains('open')) return;
            
            // Check which tab is active
            const day1Active = document.getElementById('visionDay1').classList.contains('active');
            const day2Active = document.getElementById('visionDay2').classList.contains('active');
            
            if (day1Active) {
                if (!document.getElementById('visionScreener1').value) {
                    errors.push('Vision Screening - Initial: Please select a Screener');
                }
                if (!document.querySelector('input[name="glassesDay1"]:checked')) {
                    errors.push('Vision Screening - Initial: Please select if wearing glasses/contacts');
                }
                const rightEye = document.getElementById('rightEyeDay1').value;
                const leftEye = document.getElementById('leftEyeDay1').value;
                if (!rightEye) {
                    errors.push('Vision Screening - Initial: Please enter Right Eye Acuity');
                }
                if (!leftEye) {
                    errors.push('Vision Screening - Initial: Please enter Left Eye Acuity');
                }
                if (!document.querySelector('input[name="visionResultDay1"]:checked')) {
                    errors.push('Vision Screening - Initial: Please select Pass/Fail result');
                }
            }
            
            if (day2Active) {
                if (!document.getElementById('visionScreener2').value) {
                    errors.push('Vision Screening - Rescreen: Please select a Screener');
                }
                if (!document.querySelector('input[name="glassesDay2"]:checked')) {
                    errors.push('Vision Screening - Rescreen: Please select if wearing glasses/contacts');
                }
                const rightEye = document.getElementById('rightEyeDay2').value;
                const leftEye = document.getElementById('leftEyeDay2').value;
                if (!rightEye) {
                    errors.push('Vision Screening - Rescreen: Please enter Right Eye Acuity');
                }
                if (!leftEye) {
                    errors.push('Vision Screening - Rescreen: Please enter Left Eye Acuity');
                }
                if (!document.querySelector('input[name="visionResultDay2"]:checked')) {
                    errors.push('Vision Screening - Rescreen: Please select Pass/Fail result');
                }
            }
        }

        function validateHearingSection(errors) {
            const hearingContent = document.getElementById('hearing-content');
            if (!hearingContent.classList.contains('open')) return;
            
            const day1Active = document.getElementById('hearingDay1').classList.contains('active');
            const day2Active = document.getElementById('hearingDay2').classList.contains('active');
            
            if (day1Active) {
                if (!document.getElementById('hearingScreener1').value) {
                    errors.push('Hearing Screening - Initial: Please select a Screener');
                }
                
                // Check all frequencies for both ears
                const frequencies = ['1000', '2000', '4000'];
                frequencies.forEach(freq => {
                    if (!document.querySelector(`input[name="hearingRight${freq}Day1"]:checked`)) {
                        errors.push(`Hearing Screening - Initial: Please select Pass/Fail for Right Ear ${freq} Hz`);
                    }
                    if (!document.querySelector(`input[name="hearingLeft${freq}Day1"]:checked`)) {
                        errors.push(`Hearing Screening - Initial: Please select Pass/Fail for Left Ear ${freq} Hz`);
                    }
                });
                
                if (!document.querySelector('input[name="hearingResultDay1"]:checked')) {
                    errors.push('Hearing Screening - Initial: Please select Overall Pass/Fail result');
                }
            }
            
            if (day2Active) {
                if (!document.getElementById('hearingScreener2').value) {
                    errors.push('Hearing Screening - Rescreen: Please select a Screener');
                }
                
                const frequencies = ['1000', '2000', '4000'];
                frequencies.forEach(freq => {
                    if (!document.querySelector(`input[name="hearingRight${freq}Day2"]:checked`)) {
                        errors.push(`Hearing Screening - Rescreen: Please select Pass/Fail for Right Ear ${freq} Hz`);
                    }
                    if (!document.querySelector(`input[name="hearingLeft${freq}Day2"]:checked`)) {
                        errors.push(`Hearing Screening - Rescreen: Please select Pass/Fail for Left Ear ${freq} Hz`);
                    }
                });
                
                if (!document.querySelector('input[name="hearingResultDay2"]:checked')) {
                    errors.push('Hearing Screening - Rescreen: Please select Overall Pass/Fail result');
                }
            }
        }

        function validateAcanthosisSection(errors) {
            const acanthosisContent = document.getElementById('acanthosis-content');
            if (!acanthosisContent.classList.contains('open')) return;
            
            const day1Active = document.getElementById('acanthosisDay1').classList.contains('active');
            const day2Active = document.getElementById('acanthosisDay2').classList.contains('active');
            
            if (day1Active) {
                if (!document.getElementById('acanthosisScreener1').value) {
                    errors.push('Acanthosis Nigricans - Initial: Please select a Screener');
                }
                if (!document.querySelector('input[name="acanthosisResultDay1"]:checked')) {
                    errors.push('Acanthosis Nigricans - Initial: Please select Pass/Fail result');
                }
            }
            
            if (day2Active) {
                if (!document.getElementById('acanthosisScreener2').value) {
                    errors.push('Acanthosis Nigricans - Rescreen: Please select a Screener');
                }
                if (!document.querySelector('input[name="acanthosisResultDay2"]:checked')) {
                    errors.push('Acanthosis Nigricans - Rescreen: Please select Pass/Fail result');
                }
            }
        }

        function validateScoliosisSection(errors) {
            const scoliosisContent = document.getElementById('scoliosis-content');
            if (!scoliosisContent.classList.contains('open')) return;
            
            const day1Active = document.getElementById('scoliosisDay1').classList.contains('active');
            const day2Active = document.getElementById('scoliosisDay2').classList.contains('active');
            
            if (day1Active) {
                if (!document.getElementById('scoliosisScreener1').value) {
                    errors.push('Scoliosis Screening - Initial: Please select a Screener');
                }
                if (!document.querySelector('input[name="scoliosisResultDay1"]:checked')) {
                    errors.push('Scoliosis Screening - Initial: Please select Pass/Fail result');
                }
            }
            
            if (day2Active) {
                if (!document.getElementById('scoliosisScreener2').value) {
                    errors.push('Scoliosis Screening - Rescreen: Please select a Screener');
                }
                if (!document.querySelector('input[name="scoliosisResultDay2"]:checked')) {
                    errors.push('Scoliosis Screening - Rescreen: Please select Pass/Fail result');
                }
            }
        }

        function showValidationError(errors) {
            const modal = document.createElement('div');
            modal.id = 'validationModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            const errorList = errors.map(err => `<li style="margin-bottom: 8px; text-align: left;">${err}</li>`).join('');
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 40px;
                border-radius: 20px;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            
            modalContent.innerHTML = `
                <div style="color: #e74c3c; font-size: 4rem; margin-bottom: 20px;">‚ö†Ô∏è</div>
                <h2 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.8rem;">Please Complete Required Fields</h2>
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 2px solid #ffc107;">
                    <ul style="list-style-position: inside; color: #856404; font-size: 0.95rem; line-height: 1.6;">
                        ${errorList}
                    </ul>
                </div>
                <button onclick="closeValidationModal()" style="
                    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
                    color: white;
                    border: none;
                    padding: 15px 40px;
                    font-size: 1.1rem;
                    font-weight: 600;
                    border-radius: 50px;
                    cursor: pointer;
                    box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
                    transition: transform 0.2s ease;
                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    Got It
                </button>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }

        function closeValidationModal() {
            const modal = document.getElementById('validationModal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }

        function gatherScreeningData(prefix, suffix) {
            return {
                day1: {
                    screener: document.getElementById(prefix + 'Screener1' + suffix)?.value,
                    result: document.querySelector(`input[name="${prefix}ResultDay1${suffix}"]:checked`)?.value,
                    // Add specific data based on screening type
                },
                day2: {
                    screener: document.getElementById(prefix + 'Screener2' + suffix)?.value,
                    result: document.querySelector(`input[name="${prefix}ResultDay2${suffix}"]:checked`)?.value
                }
            };
        }

        function showSuccessModal(formData) {
            // Format the date for display
            const dateObj = new Date(formData.screeningDate + 'T00:00:00');
            const formattedDate = dateObj.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Create modal overlay
            const modal = document.createElement('div');
            modal.id = 'successModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 50px;
                border-radius: 20px;
                max-width: 600px;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            
            modalContent.innerHTML = `
                <div style="color: #27ae60; font-size: 5rem; margin-bottom: 20px;">‚úÖ</div>
                <h2 style="color: #2c3e50; margin-bottom: 20px; font-size: 2rem;">Screening Submitted Successfully!</h2>
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 30px; text-align: left;">
                    <div style="margin-bottom: 10px;"><strong>Student:</strong> ${formData.student.firstName} ${formData.student.lastName}</div>
                    <div style="margin-bottom: 10px;"><strong>Grade:</strong> ${formData.student.grade}</div>
                    <div style="margin-bottom: 10px;"><strong>School:</strong> ${formData.student.school}</div>
                    <div style="margin-bottom: 10px;"><strong>Screener:</strong> ${formData.screenerName}</div>
                    <div><strong>Date:</strong> ${formattedDate}</div>
                </div>
                <button onclick="resetFormAndCloseModal()" style="
                    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
                    color: white;
                    border: none;
                    padding: 15px 40px;
                    font-size: 1.1rem;
                    font-weight: 600;
                    border-radius: 50px;
                    cursor: pointer;
                    margin-right: 15px;
                    box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
                    transition: transform 0.2s ease;
                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    Screen Next Student
                </button>
                <button onclick="closeModal()" style="
                    background: #6c757d;
                    color: white;
                    border: none;
                    padding: 15px 40px;
                    font-size: 1.1rem;
                    font-weight: 600;
                    border-radius: 50px;
                    cursor: pointer;
                    box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
                    transition: transform 0.2s ease;
                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    Done
                </button>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }

        function resetFormAndCloseModal() {
            closeModal();
            setTimeout(() => {
                // Clear student information
                document.getElementById('uniqueId').value = '';
                document.getElementById('studentGrade').value = '';
                document.getElementById('studentFirstName').value = '';
                document.getElementById('studentLastName').value = '';
                document.getElementById('studentGender').value = '';
                document.getElementById('studentSchool').value = '';
                document.getElementById('studentTeacher').value = '';
                document.getElementById('studentDOB').value = '';
                document.getElementById('studentStatus').value = '';
                
                // Keep screenerName and screeningDate - DON'T clear them!
                // document.getElementById('screenerName').value stays the same
                // document.getElementById('screeningDate').value stays the same
                
                // Reset absent to "Present"
                document.querySelector('input[name="absent"][value="no"]').checked = true;
                document.getElementById('screeningTestsContainer').classList.remove('hidden');
                document.getElementById('acanthosisSection').classList.remove('hidden');
                document.getElementById('scoliosisSection').classList.remove('hidden');
                
                // Clear all screening sections
                clearAllScreeningSections();
                
                // Close all collapsible sections
                closeAllScreeningSections();
                
                // Clear notes
                document.getElementById('notes').value = '';
            }, 300);
        }

        function clearAllScreeningSections() {
            // Clear Vision Day 1
            document.getElementById('visionScreener1').value = document.getElementById('screenerName').value;
            document.querySelectorAll('input[name="glassesDay1"]').forEach(input => input.checked = false);
            document.getElementById('rightEyeDay1').value = '';
            document.getElementById('leftEyeDay1').value = '';
            document.querySelectorAll('input[name="visionResultDay1"]').forEach(input => input.checked = false);
            
            // Clear Vision Day 2
            document.getElementById('visionScreener2').value = document.getElementById('screenerName').value;
            document.querySelectorAll('input[name="glassesDay2"]').forEach(input => input.checked = false);
            document.getElementById('rightEyeDay2').value = '';
            document.getElementById('leftEyeDay2').value = '';
            document.querySelectorAll('input[name="visionResultDay2"]').forEach(input => input.checked = false);
            
            // Clear Hearing Day 1
            document.getElementById('hearingScreener1').value = document.getElementById('screenerName').value;
            ['1000', '2000', '4000'].forEach(freq => {
                document.querySelectorAll(`input[name="hearingRight${freq}Day1"]`).forEach(input => input.checked = false);
                document.querySelectorAll(`input[name="hearingLeft${freq}Day1"]`).forEach(input => input.checked = false);
            });
            document.querySelectorAll('input[name="hearingResultDay1"]').forEach(input => input.checked = false);
            
            // Clear Hearing Day 2
            document.getElementById('hearingScreener2').value = document.getElementById('screenerName').value;
            ['1000', '2000', '4000'].forEach(freq => {
                document.querySelectorAll(`input[name="hearingRight${freq}Day2"]`).forEach(input => input.checked = false);
                document.querySelectorAll(`input[name="hearingLeft${freq}Day2"]`).forEach(input => input.checked = false);
            });
            document.querySelectorAll('input[name="hearingResultDay2"]').forEach(input => input.checked = false);
            
            // Clear Acanthosis Day 1
            document.getElementById('acanthosisScreener1').value = document.getElementById('screenerName').value;
            document.querySelectorAll('input[name="acanthosisResultDay1"]').forEach(input => input.checked = false);
            
            // Clear Acanthosis Day 2
            document.getElementById('acanthosisScreener2').value = document.getElementById('screenerName').value;
            document.querySelectorAll('input[name="acanthosisResultDay2"]').forEach(input => input.checked = false);
            
            // Clear Scoliosis Day 1
            document.getElementById('scoliosisScreener1').value = document.getElementById('screenerName').value;
            document.querySelectorAll('input[name="scoliosisObservationsDay1"]').forEach(input => input.checked = false);
            document.querySelectorAll('input[name="scoliosisResultDay1"]').forEach(input => input.checked = false);
            
            // Clear Scoliosis Day 2
            document.getElementById('scoliosisScreener2').value = document.getElementById('screenerName').value;
            document.querySelectorAll('input[name="scoliosisObservationsDay2"]').forEach(input => input.checked = false);
            document.querySelectorAll('input[name="scoliosisResultDay2"]').forEach(input => input.checked = false);
            
            // Reset all tabs to Day 1
            ['vision', 'hearing', 'acanthosis', 'scoliosis'].forEach(type => {
                const day1 = document.getElementById(`${type}Day1`);
                const day2 = document.getElementById(`${type}Day2`);
                const tabs = document.querySelectorAll(`#${type}Section .session-tab`);
                
                if (day1 && day2 && tabs.length >= 2) {
                    tabs[0].classList.add('active');
                    tabs[1].classList.remove('active');
                    day1.classList.add('active');
                    day2.classList.remove('active');
                }
            });
            
            // Clear all visual "selected" states from radio options
            document.querySelectorAll('.radio-option').forEach(opt => {
                opt.classList.remove('selected');
            });
        }

        function closeModal() {
            const modal = document.getElementById('successModal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }

        // Toggle collapsible sections

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
            @keyframes slideIn {
                from { transform: translateY(-50px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Load schools when page loads
        window.addEventListener('load', loadSchools);
        
        // Show all screening sections by default when page loads
        window.addEventListener('load', function() {
            document.getElementById('visionSection').style.display = 'block';
            document.getElementById('hearingSection').style.display = 'block';
            document.getElementById('acanthosisSection').style.display = 'block';
            document.getElementById('scoliosisSection').style.display = 'block';
            
            // All sections start closed by default
            // They will be opened based on student requirements when a student is searched
        });

        // Function to determine required screenings based on student data
        function getRequiredScreenings(grade, gender, status) {
            const isNew = status.toLowerCase() === 'new';
            const gradeLower = grade.toLowerCase();
            const genderLower = gender.toLowerCase();
            
            const required = {
                vision: false,
                hearing: false,
                acanthosis: false,
                scoliosis: false
            };

            // PreK 3, PreK 4, Kinder
            if (gradeLower.includes('pre-k') || gradeLower.includes('prek') || gradeLower.includes('kinder')) {
                required.vision = true;
                required.hearing = true;
            }
            // 1st grade
            else if (gradeLower.includes('1st') || gradeLower === '1') {
                required.vision = true;
                required.hearing = true;
                required.acanthosis = true;
            }
            // 2nd grade (NEW only)
            else if ((gradeLower.includes('2nd') || gradeLower === '2') && isNew) {
                required.vision = true;
                required.hearing = true;
                required.acanthosis = true;
            }
            // 3rd grade
            else if (gradeLower.includes('3rd') || gradeLower === '3') {
                required.vision = true;
                required.hearing = true;
                required.acanthosis = true;
            }
            // 4th grade (NEW only)
            else if ((gradeLower.includes('4th') || gradeLower === '4') && isNew) {
                required.vision = true;
                required.hearing = true;
                required.acanthosis = true;
            }
            // 5th grade - UPDATED FOR "OTHER"
            else if (gradeLower.includes('5th') || gradeLower === '5') {
                required.vision = true;
                required.hearing = true;
                required.acanthosis = true;
                // Scoliosis for females OR other (both get tested)
                if (genderLower === 'female' || genderLower === 'other') {
                    required.scoliosis = true;
                }
            }
            // 6th grade (NEW only)
            else if ((gradeLower.includes('6th') || gradeLower === '6') && isNew) {
                required.vision = true;
                required.hearing = true;
                required.acanthosis = true;
            }
            // 7th grade - UPDATED FOR "OTHER"
            else if (gradeLower.includes('7th') || gradeLower === '7') {
                required.vision = true;
                required.hearing = true;
                required.acanthosis = true;
                // Scoliosis for females OR other (both get tested)
                if (genderLower === 'female' || genderLower === 'other') {
                    required.scoliosis = true;
                }
            }
            // 8th grade - UPDATED FOR "OTHER"
            else if (gradeLower.includes('8th') || gradeLower === '8') {
                // Males returning: scoliosis only
                if (genderLower === 'male' && !isNew) {
                    required.scoliosis = true;
                }
                // Males new: vision, hearing, acanthosis, scoliosis
                else if (genderLower === 'male' && isNew) {
                    required.vision = true;
                    required.hearing = true;
                    required.acanthosis = true;
                    required.scoliosis = true;
                }
                // Females new: vision, hearing, acanthosis (no scoliosis - already done in 7th)
                else if (genderLower === 'female' && isNew) {
                    required.vision = true;
                    required.hearing = true;
                    required.acanthosis = true;
                }
                // OTHER: gets everything (both male and female requirements)
                else if (genderLower === 'other') {
                    required.vision = isNew; // Only if new
                    required.hearing = isNew; // Only if new
                    required.acanthosis = isNew; // Only if new
                    required.scoliosis = true; // Always (covers both genders)
                }
            }
            // 9th-12th grade (NEW only)
            else if ((gradeLower.includes('9th') || gradeLower.includes('10th') || gradeLower.includes('11th') || gradeLower.includes('12th') || 
                      gradeLower === '9' || gradeLower === '10' || gradeLower === '11' || gradeLower === '12') && isNew) {
                required.vision = true;
                required.hearing = true;
                required.acanthosis = true;
            }

            return required;
        }

        // Function to open required screening sections based on student data
        function openRequiredSections(student) {
            const requiredScreenings = getRequiredScreenings(student.grade, student.gender, student.status);
            
            // Close all sections first
            ['vision', 'hearing', 'acanthosis', 'scoliosis'].forEach(section => {
                const content = document.getElementById(`${section}-content`);
                const icon = document.getElementById(`${section}-icon`);
                const header = document.querySelector(`[data-section="${section}"] .collapsible-header`);
                
                if (content) content.classList.remove('open');
                if (icon) {
                    icon.classList.remove('open');
                    icon.textContent = '‚ñ∂';
                }
                if (header) header.classList.remove('active');
            });
            
            // Open only required sections
            if (requiredScreenings.vision) {
                openAccordion('vision');
            }
            if (requiredScreenings.hearing) {
                openAccordion('hearing');
            }
            if (requiredScreenings.acanthosis) {
                openAccordion('acanthosis');
            }
            if (requiredScreenings.scoliosis) {
                openAccordion('scoliosis');
            }
            
            // Update required screenings banner
            showRequiredScreenings(requiredScreenings);
        }
    </script>
</body>
</html>